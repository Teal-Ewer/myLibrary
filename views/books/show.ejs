<%- include('../partials/html-head') %> 
<link rel="stylesheet" href="/stylesheets/style.css">
<%- include('../partials/nav') %>

<main class="container d-flex">
	<div class="card col-6 p-2 mt-3 row">
		<div class="row">
			<img src="<%= book.cover %> " class="rounded-start col-4" alt="..." />
			<div class="col-8">
				<h2 class="card-title"><%= book.title %></h2>
				<h4 class="card-title"><%= book.authors.join(", ") %></h4>
				<% if (book.ownedBy.includes(user.profile._id)) { %>
					<form action="/books/<%= book._id %>?_method=DELETE" method="POST">
						<button class="btn btn-danger">Delete</button>
					</form>
					<% if (book.availableFrom.includes(thisUser)) { %>
					<h5>Check out your copy</h5>
					<form action="/books/<%= book._id %>/updateAvailability" method="GET">
						<button class="btn btn-warning">Check Out</button>
					</form>  
					<% } else {%>
							<h5>Your copy is checked out!</h5>
					<form class="d-block" action="/books/<%= book._id %>/updateAvailability" method="GET">
						<button class="btn btn-warning">Check In</button>
					</form> 
						<% } %> 
				<% } else { %>
					<form action="/books/<%= book._id %>/update" method="GET">
						<button class="btn btn-primary">Add</button>
					</form>
				<% } %> 
			</div>
		</div>
		<div class="card-body col-12 row">
			<% let available = [] %> 
			<% book.availableFrom.forEach(profile => { %>
			 <% available.push(profile.name) %> 
			<% }) %>
			<p>Available from: <%= available.join(", ") %> </p>
			<p class="card-text"><%= book.description %></p>
		</div>
	</div>
	<div class="card col-6 p-2 mt-3 row">
		<div class="row">
			<h1>Reviews</h1>
		</div>
	</div>
</main>

<%- include('../partials/footer') %>
